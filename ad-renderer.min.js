!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.Convbase=t():e.Convbase=t()}(this,(()=>(()=>{"use strict";var e="http://127.0.0.1:5000",t="cachedAds",n="cachedAdsTimestamp",r=36e5,o="cachedWebsite",a="cachedWebsiteTimestamp",i=36e5,c=document.getElementById("ConvbaseTag"),s=null==c?void 0:c.getAttribute("data-hash");null==c||c.getAttribute("data-ad-container-id");var l=function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{s(r.next(e))}catch(e){a(e)}}function c(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,c)}s((r=r.apply(e,t||[])).next())}))},u=function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,c[0]&&(i=0)),i;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return i.label++,{value:c[1],done:!1};case 5:i.label++,r=c[1],c=[0];continue;case 7:c=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){i=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){i.label=c[1];break}if(6===c[0]&&i.label<o[1]){i.label=o[1],o=c;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(c);break}o[2]&&i.ops.pop(),i.trys.pop();continue}c=t.call(e,i)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}};function d(r){return l(this,void 0,void 0,(function(){var o,a;return u(this,(function(i){switch(i.label){case 0:return i.trys.push([0,3,,4]),[4,fetch(e+"/get-ad",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)})];case 1:return[4,i.sent().json()];case 2:return o=i.sent(),c=o,localStorage.setItem(t,JSON.stringify(c)),localStorage.setItem(n,Date.now().toString()),[2,o];case 3:return a=i.sent(),console.error("Failed to load ad:",a),[2,null];case 4:return[2]}var c}))}))}function f(t,n){return l(this,void 0,void 0,(function(){var r,o;return u(this,(function(a){switch(a.label){case 0:return a.trys.push([0,3,,4]),[4,fetch(e+"/ad-impression",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({advertisement_id:t,website_id:n})})];case 1:return[4,a.sent().json()];case 2:return(r=a.sent()).error&&console.error("Error updating ad metrics: ".concat(r.error)),[3,4];case 3:return o=a.sent(),console.error("Failed to update ad metrics:",o),[3,4];case 4:return[2]}}))}))}var p=function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{s(r.next(e))}catch(e){a(e)}}function c(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,c)}s((r=r.apply(e,t||[])).next())}))},h=function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,c[0]&&(i=0)),i;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return i.label++,{value:c[1],done:!1};case 5:i.label++,r=c[1],c=[0];continue;case 7:c=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){i=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){i.label=c[1];break}if(6===c[0]&&i.label<o[1]){i.label=o[1],o=c;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(c);break}o[2]&&i.ops.pop(),i.trys.pop();continue}c=t.call(e,i)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}};function y(t){return p(this,void 0,void 0,(function(){var n,r;return h(this,(function(i){switch(i.label){case 0:return[4,fetch("".concat(e,"/get-website-by-url?url=").concat(encodeURIComponent(t)),{method:"GET",headers:{"Content-Type":"application/json"}})];case 1:return(n=i.sent()).ok?[4,n.json()]:[3,3];case 2:return r=i.sent(),console.log(r),c=r,localStorage.setItem(o,JSON.stringify(c)),localStorage.setItem(a,Date.now().toString()),[2,r.data];case 3:return console.error("Failed to fetch website by URL"),[2,null]}var c}))}))}var b=function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{s(r.next(e))}catch(e){a(e)}}function c(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,c)}s((r=r.apply(e,t||[])).next())}))},v=function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,c[0]&&(i=0)),i;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return i.label++,{value:c[1],done:!1};case 5:i.label++,r=c[1],c=[0];continue;case 7:c=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){i=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){i.label=c[1];break}if(6===c[0]&&i.label<o[1]){i.label=o[1],o=c;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(c);break}o[2]&&i.ops.pop(),i.trys.pop();continue}c=t.call(e,i)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}};function g(e){return b(this,void 0,void 0,(function(){var o,a,i;return v(this,(function(c){switch(c.label){case 0:return o=localStorage.getItem(t),a=localStorage.getItem(n),o&&a?(i=Date.now(),i-Number(a)<r?[2,JSON.parse(o)]:[3,3]):[3,1];case 1:return[4,d(e)];case 2:return[2,c.sent()];case 3:return[2,null]}}))}))}function m(){return b(this,void 0,void 0,(function(){var e,t,n;return v(this,(function(r){switch(r.label){case 0:return e=localStorage.getItem(o),t=localStorage.getItem(a),e&&t?(n=Date.now(),n-Number(t)<i?[2,JSON.parse(e)]:[3,3]):[3,1];case 1:return[4,y(window.location.origin)];case 2:return[2,r.sent()];case 3:return[2,null]}}))}))}function w(e){var t=new XMLHttpRequest;t.open("GET","https://api.ipgeolocation.io/ipgeo?apiKey=b241516d57d94b4ca206ed8656a81155",!0),t.onreadystatechange=function(){if(t.readyState===XMLHttpRequest.DONE)if(200===t.status){var n=JSON.parse(t.responseText);e(n.country_code2)}else console.error("Failed to get ISO code:",t.status,t.statusText),e(null)},t.send()}function x(e){return function(e){if("image"===e.ad_format)return'<a href="'.concat(e.url,'" target="_blank" style="display: contents;"><img src="').concat(e.data,'" style="margin: auto; height: 100%; object-fit: contain;" alt="').concat(e.title,'"></a>');if("rich_media"===e.ad_format)return'<a href="'.concat(e.url,'" target="_blank" style="display: contents; padding: 10px; text-decoration: none; color: black; border: 1px solid #ccc; border-radius: 5px;"><h3>').concat(e.title,"</h3><p>").concat(e.data,"</p></a>");if("video"===e.ad_format)return'<video controls style="width: 100%; height: 100%; object-fit: contain;"><source src="'.concat(e.data,'" type="video/mp4">Your browser does not support the video tag.</video>');return""}(e)}function k(e,t){var n=document.getElementById("convbase-header"),r=document.getElementById("convbase-footer");if(!(n&&"top"==e||r&&"bottom"==e)){var o=document.createElement("div");o.style.position="fixed",o.style.width="100%",o.style.display="block",o.style.alignItems="center",o.style.justifyContent="space-between",o.style.padding="0 20px",o.style.boxSizing="border-box",o.style.fontFamily="Arial, sans-serif",o.style.zIndex="7000",C(o);var a=document.createElement("button");a.innerText="X",a.style.display="block",a.style.width="60px",a.style.position="absolute",a.style.border="none",a.style.fontSize="16px",a.style.cursor="pointer",C(a),"top"===e?(o.style.top="0",o.id="convbase-header",a.style.bottom="-24px",a.style.left="0",a.style.borderRadius="0 0 16px 16px"):(o.style.bottom="0",o.id="convbase-footer",a.style.top="-24px",a.style.left="0",a.style.borderRadius="16px 16px 0 0"),a.onclick=function(){o.style.display="none",setTimeout((function(){o.style.display="block"}),3e4)};var i=document.createElement("span");i.style.display="block",i.style.maxHeight="90px",i.innerHTML=function(e){if("image"===e.ad_format)return'<a href="'.concat(e.url,'" target="_blank" style="display: contents;">\n            <img src="').concat(e.data,'" style="margin: auto; padding: 5px 0; height: 100%; \n             min-height: 50px; max-height: 90px; object-fit: contain;" alt="').concat(e.title,'"\n            >\n        </a>');if("rich_media"===e.ad_format)return'<a href="'.concat(e.url,'" target="_blank" style="display: contents; padding: 10px;\n         text-decoration: none; color: black; border: 1px solid #ccc; border-radius: 5px;">\n         <h3>').concat(e.title,"</h3><p>").concat(e.data,"</p>\n        </a>");if("video"===e.ad_format)return'<video controls style="width: 100%; height: 100%; object-fit: contain;">\n            <source src="'.concat(e.data,'" type="video/mp4">\n            Your browser does not support the video tag.\n        </video>');return'<iframe style="margin: auto; width: 100%; height: 100%; min-height: 50px;\n        max-height: 90px; object-fit: contain; background: url('.concat(e.data,') no-repeat center center;"\n        onclick="window.open(').concat(e.url,", '_blank')\"\n    ></iframe>")}(t),o.appendChild(i),o.appendChild(a),document.body.appendChild(o),function(e,t){I(e,t)}(o,t)}}function S(e){if(!document.getElementById("convbase-overlay")){var t=document.createElement("div");t.id="convbase-overlay",t.style.position="fixed",t.style.top="0",t.style.left="0",t.style.width="100vw",t.style.height="100vh",t.style.backgroundColor="rgba(0, 0, 0, 0.5)",t.style.zIndex="8000";var n=document.createElement("div");n.id="convbase-popup",n.style.position="fixed",n.style.maxWidth="80%",n.style.maxHeight="75%",n.style.top="50%",n.style.left="50%",n.style.transform="translate(-50%, -50%)",n.style.zIndex="8000",n.style.padding="0 1.5em 1.5em",n.style.boxShadow="0 4px 8px rgba(0, 0, 0, 0.2)",n.style.borderRadius="8px",C(n);var r=document.createElement("div");r.style.width="100%",r.style.display="table",r.style.height="24px",r.style.backgroundColor="#fff",C(r);var o=document.createElement("button");o.innerHTML="X",o.style.float="right",o.style.padding="12px 10px",o.style.color="#aaa",o.style.fontSize="16px",o.style.fontWeight="bold";var a=document.createElement("div");a.innerHTML=function(e){if("image"===e.ad_format)return'<a href="'.concat(e.url,'" target="_blank" style="display: contents;">\n    <img src="').concat(e.data,'" style="margin: auto; height: 100%; object-fit: contain;"\n     alt="').concat(e.title,'">\n    </a>');if("rich_media"===e.ad_format)return'<a href="'.concat(e.url,'" target="_blank" style="display: contents; padding: 10px; \n      text-decoration: none; color: black; border: 1px solid #ccc; border-radius: 5px;">\n      <h3>').concat(e.title,"</h3><p>").concat(e.data,"</p>\n    </a>");if("video"===e.ad_format)return'<video controls style="width: 100%; height: 100%; object-fit: contain;">\n      <source src="'.concat(e.data,'" type="video/mp4">Your browser does not support the video tag.\n    </video>');return""}(e),o.onclick=function(){t.hidden=!0,setTimeout((function(){t.hidden=!1}),3e4)},r.appendChild(o),n.appendChild(r),n.appendChild(a),t.appendChild(n),document.body.appendChild(t),function(e,t){I(e,t)}(n,e)}}var E=function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{s(r.next(e))}catch(e){a(e)}}function c(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,c)}s((r=r.apply(e,t||[])).next())}))},T=function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,c[0]&&(i=0)),i;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return i.label++,{value:c[1],done:!1};case 5:i.label++,r=c[1],c=[0];continue;case 7:c=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){i=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){i.label=c[1];break}if(6===c[0]&&i.label<o[1]){i.label=o[1],o=c;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(c);break}o[2]&&i.ops.pop(),i.trys.pop();continue}c=t.call(e,i)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}};function _(e,t){switch(e){case"classic_banners":default:return x(t);case"pop_under":return S(t),"";case"header_banner":return k("top",t),"";case"sticky_banner":return k("bottom",t),""}}function C(e){(function(e){var t=e.match(/\d+/g);if(!t)return!1;var n=parseInt(t[0],10),r=parseInt(t[1],10),o=parseInt(t[2],10);return.299*n+.587*r+.114*o<150})(getComputedStyle(document.body).backgroundColor)?(e.style.color="#000000",e.style.backgroundColor="#f5f5f5"):(e.style.color="#FFFFFF",e.style.backgroundColor="#1c1c1c")}function I(t,n){var r=this,o=t.getElementsByTagName("a")[0];o&&o.addEventListener("click",(function(t){return E(r,void 0,void 0,(function(){var t;return T(this,(function(r){switch(r.label){case 0:return[4,m()];case 1:return t=r.sent(),function(t,n){l(this,void 0,void 0,(function(){var r,o;return u(this,(function(a){switch(a.label){case 0:return a.trys.push([0,3,,4]),[4,fetch(e+"/ad-click",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({ad:t,website_id:n})})];case 1:return[4,a.sent().json()];case 2:return(r=a.sent()).error&&console.error("Error updating ad metrics: ".concat(r.error)),[3,4];case 3:return o=a.sent(),console.error("Failed to update ad metrics:",o),[3,4];case 4:return[2]}}))}))}(n,t.id),[2]}}))}))}))}var j=function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{s(r.next(e))}catch(e){a(e)}}function c(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,c)}s((r=r.apply(e,t||[])).next())}))},O=function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,c[0]&&(i=0)),i;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return i.label++,{value:c[1],done:!1};case 5:i.label++,r=c[1],c=[0];continue;case 7:c=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){i=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){i.label=c[1];break}if(6===c[0]&&i.label<o[1]){i.label=o[1],o=c;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(c);break}o[2]&&i.ops.pop(),i.trys.pop();continue}c=t.call(e,i)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}},F=!1,N=new MutationObserver((function(e){return j(this,void 0,void 0,(function(){var t,n,r;return O(this,(function(o){switch(o.label){case 0:t=0,n=e,o.label=1;case 1:return t<n.length?"childList"!==(r=n[t]).type?[3,3]:[4,A()]:[3,5];case 2:return o.sent(),[3,4];case 3:r.type,o.label=4;case 4:return t++,[3,1];case 5:return[2]}}))}))})),L=document.body,P={attributes:!0,childList:!0,subtree:!0};function A(){return j(this,void 0,void 0,(function(){var e,t,n;return O(this,(function(r){switch(r.label){case 0:if(F)return[2];F=!0,e={userAgent:navigator.userAgent,platform:navigator.platform,language:navigator.language,cookieEnabled:navigator.cookieEnabled,screenWidth:screen.width,screenHeight:screen.height,timezone:Intl.DateTimeFormat().resolvedOptions().timeZone},r.label=1;case 1:return r.trys.push([1,3,,4]),[4,new Promise((function(e,t){if(navigator.geolocation)navigator.geolocation.getCurrentPosition((function(t){e({latitude:t.coords.latitude,longitude:t.coords.longitude})}),(function(e){console.error("Geolocation error:",e.message),t(new Error("Failed to retrieve geolocation."))}));else{var n="Geolocation is not supported by this browser.";console.warn(n),t(new Error(n))}}))];case 2:return t=r.sent(),w((function(n){return j(this,void 0,void 0,(function(){var r;return O(this,(function(o){switch(o.label){case 0:return n?(r={browserInfo:e,isoCode:n,hash:s,location:t},N.disconnect(),[4,m()]):(console.error("ISO country code could not be retrieved."),F=!1,[2]);case 1:return o.sent(),[4,G(r)];case 2:return o.sent(),N.observe(L,P),F=!1,[2]}}))}))})),[3,4];case 3:return n=r.sent(),console.error(n.message),w((function(t){return j(this,void 0,void 0,(function(){var n;return O(this,(function(r){switch(r.label){case 0:return t?(n={browserInfo:e,isoCode:t,hash:s,location:{latitude:null,longitude:null}},N.disconnect(),[4,m()]):(console.error("Both geolocation and ISO country code retrieval failed. Aborting request."),F=!1,[2]);case 1:return r.sent(),[4,G(n)];case 2:return r.sent(),N.observe(L,P),F=!1,[2]}}))}))})),[3,4];case 4:return[2]}}))}))}function G(e){return j(this,void 0,void 0,(function(){var t,n,r,o,a,i,c,s;return O(this,(function(l){switch(l.label){case 0:return(t=document.querySelectorAll("[data-ad-container]")).length>0?[4,m()]:[3,3];case 1:return n=l.sent(),[4,g(e)];case 2:if(r=l.sent())for(o=0,a=0;o<t.length;o++,a++)i=r[a],(c=t[o])?(i||(i=r[a=0]),s=_(i.ad_type,i),c.innerHTML=s,I(c,i),f(i.id,n.id)):console.error("No ad container found at index ".concat(o));l.label=3;case 3:return[2]}}))}))}return document.addEventListener("DOMContentLoaded",(function(){A()})),{}})()));
